{% macro render_archive(posts, macro_post_render) %}
  <ul class="unstyled">
    {% for post in posts %}
      {% set ny = post.published.year %}
      {% set nm = post.published.month %}
      {# render only year and month combination once #}
      {% if loop.first or (ny != y and nm != m) %}
        {% set y = ny %}
        {% set m = nm %}
        <li>
          <h1>{{ y }} {{ m|month_name }}</h1>
          {# render all posts in this year and month #}
          <ul>
            {% for post in posts if post.published.year == y and post.published.month == m %}
              <li>
                {{ macro_post_render(post) }}
              </li>
            {% endfor %}
          </ul>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
{% endmacro %}


{% macro render_archive_post(post) %}
  <a href="{{ url_for('frontend.detail', slug=post.slug) }}">{{ post.title }}</a>
{% endmacro %}


{% macro render_archive_post_admin(post) %}
<a class="link-color-only" href="{{ url_for('admin.delete_post', slug=post.slug) }}"><i class="icon-remove"></i></a>

{% if not post.visible %}
<i class="icon-eye-close"></i>
{% endif %}

<a href="{{ url_for('admin.edit_post', slug=post.slug) }}">{{ post.title }}</a>
{% endmacro %}
